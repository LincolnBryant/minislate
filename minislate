#!/bin/bash

init() {
  docker-compose up -d
  docker-compose exec kube ./init.sh
  docker-compose exec slate helm init --service-account tiller
  docker-compose exec slate pip install -r /opt/slate-portal/requirements.txt
  docker-compose exec slate sh -c "sed -i 's/localhost/0\.0\.0\.0/g' /opt/slate-portal/run_*"
  docker-compose exec -d slate /bin/sh -c "cd /opt/slate-portal && ./run_portal.py"
}

stop() {
  docker-compose stop
}

start() {
  docker-compose start
}

destroy() {
  docker-compose down -v
}

build() {
  docker-compose build --no-cache $1
}

shell() {
  docker-compose exec $1 /bin/bash
}

slate() {
  docker-compose exec slate slate "$@"
}

kubectl() {
  docker-compose exec slate kubectl "$@"
}

exec() {
  docker compose exec "$@"
}

if [[ $1 =~ ^(init|start|stop|destroy|address|build|shell|slate|kubectl|exec)$ ]]; then
  "$@"
else
  echo "Invalid subcommand $1" >&2
  exit 1
fi
